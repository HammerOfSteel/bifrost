<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Brimfrost - Family Tree</title>
  <script src="https://unpkg.com/d3@6"></script>
  <script src="https://unpkg.com/family-chart@0.7.2"></script>
  <link rel="stylesheet" href="https://unpkg.com/family-chart@0.7.2/dist/styles/family-chart.css">

  <style>
    /* ── Editor form rows ── */
    .danger { background:#3a1e1e !important; }
    .form-row { display:flex; gap:10px; margin-bottom:8px; }
    .form-row > label { width:140px; color:var(--muted); }
    .form-row input, .form-row textarea {
      flex:1; background:#0f1115; color:#e8ecf1; border:1px solid var(--line);
      border-radius:8px; padding:8px;
    }
  </style>

  <style>
    :root {
      --bg:#0f1115; --panel:#171a21; --soft:#1f2430; --text:#e8ecf1;
      --muted:#a9b3c1; --line:#2a3140; --accent:#7aa2f7;
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    html, body { height:100%; overflow:hidden; }
    body {
      background:var(--bg); color:var(--text);
      font-family: Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      line-height:1.6;
    }

    /* ── Topbar ── */
    .topbar { display:flex; gap:8px; align-items:center; padding:8px 12px;
      background:var(--panel); border-bottom:1px solid var(--line);
      position:sticky; top:0; z-index:5; }
    .search { position:relative; display:flex; flex:1; }
    .searchbox { display:flex; gap:8px; background:var(--soft); border:1px solid var(--line);
      padding:8px 10px; border-radius:10px; flex:1; }
    .search input { flex:1; background:transparent; border:none; color:var(--text); outline:none; }
    .btn { background:var(--soft); border:1px solid var(--line); border-radius:10px;
      padding:8px 12px; color:var(--text); cursor:pointer; margin-left:4px; font-size:13px; }
    .btn:hover { background:var(--line); }
    .btn.accent { background:linear-gradient(180deg,rgba(122,162,247,.25),rgba(122,162,247,.12));
      border:1px solid rgba(122,162,247,.35); }
    .btn.accent:hover { background:linear-gradient(180deg,rgba(122,162,247,.35),rgba(122,162,247,.18)); }
    .btn.logout { background:#3a1e1e; border-color:#8b3a3a; }
    .btn.logout:hover { background:#4a2a2a; }

    /* ── Search suggestions ── */
    .sugg { position:absolute; top:44px; left:0; right:0; background:#171a21;
      border:1px solid var(--line); border-radius:10px; overflow:hidden; z-index:6;
      display:none; max-height:320px; overflow-y:auto; }
    .sugg-item { padding:8px 10px; cursor:pointer; display:flex; align-items:center; gap:8px; }
    .sugg-item:hover { background:#1f2430; }
    .sugg-ava { width:28px; height:28px; border-radius:999px; object-fit:cover;
      background:#333; border:1px solid var(--line); }

    /* ── Admin dropdown ── */
    .dropdown { position:relative; }
    .dropdown-menu { position:absolute; right:0; top:100%; background:var(--panel);
      border:1px solid var(--line); border-radius:10px; padding:6px; display:none;
      z-index:15; min-width:220px; box-shadow:0 8px 24px rgba(0,0,0,.35); }
    .dropdown-menu.open { display:block; }
    .dropdown-item { display:block; width:100%; text-align:left; padding:8px 10px;
      background:none; border:none; color:var(--text); cursor:pointer; border-radius:8px; }
    .dropdown-item:hover { background:var(--soft); }

    /* ── Family chart container ── */
    #main-app { display:none; height:100vh; flex-direction:column; overflow:hidden; }
    #main-app.active { display:flex; }
    #FamilyChart { width:100%; height:900px; background-color:rgb(33,33,33); color:#fff; }

    /* ── Custom card styles (image cards) ── */
    .f3 .bv2-card-img img {
      border-top-left-radius: 6px;
      border-top-right-radius: 6px;
    }
    .f3 .bv2-card-img .card-label {
      width: 100%;
      background: rgba(0,0,0,0.45);
    }

    /* ── Login ── */
    #login-page { display:none; position:fixed; inset:0; align-items:center;
      justify-content:center; z-index:30; padding:24px; }
    #login-page.active { display:flex; }

    /* Scrapboard background */
    .scrapboard {
      position:absolute; inset:0; overflow:hidden;
      background:
        url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23b8956a' fill-opacity='0.06'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E"),
        linear-gradient(145deg, #2c1e14 0%, #3a2a1c 25%, #2e2018 50%, #352a1e 75%, #2c1e14 100%);
    }
    .scrapboard::before {
      content:''; position:absolute; inset:0;
      background:
        radial-gradient(ellipse 900px 600px at 20% 30%, rgba(180,140,80,.08), transparent),
        radial-gradient(ellipse 700px 500px at 80% 70%, rgba(160,120,60,.06), transparent);
      pointer-events:none;
    }

    /* Cork-board texture overlay */
    .scrapboard::after {
      content:''; position:absolute; inset:0;
      background:url("data:image/svg+xml,%3Csvg width='200' height='200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='200' height='200' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E");
      pointer-events:none;
    }

    /* Polaroid photos */
    .polaroid {
      position:absolute;
      background:#f5f0e8;
      padding:10px 10px 36px 10px;
      box-shadow: 0 4px 20px rgba(0,0,0,.4), 0 1px 4px rgba(0,0,0,.3);
      transition: transform .6s ease, opacity .6s ease;
    }
    .polaroid img {
      width:100%; height:100%; object-fit:cover;
      filter:saturate(.85) contrast(1.05);
    }
    .polaroid .caption {
      position:absolute; bottom:8px; left:0; right:0;
      text-align:center; font-family:'Segoe Print','Comic Sans MS',cursive;
      font-size:11px; color:#5a4a3a; letter-spacing:.3px;
    }
    .polaroid-1 { width:180px; height:180px; top:5%; left:3%; transform:rotate(-8deg); }
    .polaroid-2 { width:200px; height:200px; top:8%; right:5%; transform:rotate(5deg); }
    .polaroid-3 { width:170px; height:170px; bottom:10%; left:8%; transform:rotate(4deg); }
    .polaroid-4 { width:190px; height:190px; bottom:5%; right:3%; transform:rotate(-6deg); }

    /* String / twine decoration */
    .twine {
      position:absolute; top:0; left:5%; right:10%; height:100%;
      pointer-events:none; z-index:1;
    }
    .twine::before {
      content:''; position:absolute; top:12%; left:0; right:0;
      border-top:2px dashed rgba(180,140,80,.2);
      transform:rotate(-1deg);
    }
    .twine::after {
      content:''; position:absolute; bottom:18%; left:5%; right:5%;
      border-top:2px dashed rgba(180,140,80,.15);
      transform:rotate(1.5deg);
    }

    /* Pin dots on polaroids */
    .pin {
      position:absolute; top:-6px; left:50%; transform:translateX(-50%);
      width:14px; height:14px; border-radius:50%;
      background:radial-gradient(circle at 40% 35%, #d44, #922);
      box-shadow:0 2px 4px rgba(0,0,0,.4);
      z-index:2;
    }

    .login-container { width:min(440px,92vw); background:rgba(23,26,33,.92);
      border:1px solid rgba(122,162,247,.2); border-radius:20px; padding:28px 26px;
      backdrop-filter:blur(20px); -webkit-backdrop-filter:blur(20px);
      position:relative; z-index:10;
      box-shadow: 0 8px 40px rgba(0,0,0,.5), 0 0 80px rgba(122,162,247,.08); }
    .login-header { display:flex; flex-direction:column; align-items:center; margin-bottom:20px; }
    .login-header h1 { margin:12px 0 4px; font-size:26px; text-align:center;
      background:linear-gradient(135deg, #ff6b6b, #ffa94d, #ffd43b, #69db7c, #74c0fc, #b197fc);
      -webkit-background-clip:text; -webkit-text-fill-color:transparent;
      background-clip:text; font-weight:700; }
    .login-header .subtitle { font-size:13px; color:var(--muted); letter-spacing:.5px; }
    .form-group { margin-bottom:16px; display:flex; flex-direction:column; }
    .form-group label { margin-bottom:8px; color:var(--muted); font-size:14px; }
    .form-group input { background:rgba(31,36,48,.8); border:1px solid var(--line);
      border-radius:8px; padding:10px 12px; color:var(--text); font-size:16px; }
    .form-group input:focus { outline:none; border-color:var(--accent);
      box-shadow:0 0 0 3px rgba(122,162,247,.15); }
    .login-btn { width:100%; padding:12px; border:none;
      border-radius:8px; color:white; font-size:16px; font-weight:600; cursor:pointer;
      margin-top:16px; transition:all .3s;
      background:linear-gradient(135deg, #7aa2f7 0%, #b197fc 50%, #ffa94d 100%);
      background-size:200% 100%; }
    .login-btn:hover { background-position:100% 0; box-shadow:0 4px 20px rgba(122,162,247,.3); }
    .login-btn:disabled { opacity:.5; cursor:not-allowed; }
    .error { background:#3a1e1e; border:1px solid #8b3a3a; color:#ff9999;
      padding:12px; border-radius:8px; margin-bottom:16px; }

    @media (max-width:768px) {
      .polaroid { transform:scale(.6) !important; }
      .polaroid-1 { top:2%; left:-2%; }
      .polaroid-2 { top:2%; right:-2%; }
      .polaroid-3 { bottom:2%; left:-2%; }
      .polaroid-4 { bottom:2%; right:-2%; }
    }

    /* ── Admin Panel ── */
    #adminPanel { z-index:25; }
    #adminPanel > .card { width:min(960px,calc(100% - 24px)); max-height:92vh; }
    .admin-tabs { display:flex; gap:4px; border-bottom:1px solid var(--line); margin-bottom:16px; }
    .admin-tab { padding:10px 18px; background:transparent; border:none; color:var(--muted);
      cursor:pointer; font-size:14px; border-bottom:2px solid transparent; transition:all .2s; }
    .admin-tab:hover { color:var(--text); background:var(--soft); }
    .admin-tab.active { color:var(--accent); border-bottom-color:var(--accent); }
    .admin-content { display:none; }
    .admin-content.active { display:block; }
    .admin-stats { display:grid; grid-template-columns:repeat(auto-fill,minmax(140px,1fr)); gap:12px; margin-bottom:20px; }
    .stat-card { background:var(--soft); border:1px solid var(--line); border-radius:12px; padding:16px; text-align:center; }
    .stat-card .stat-num { font-size:28px; font-weight:700; color:var(--accent); }
    .stat-card .stat-label { font-size:12px; color:var(--muted); margin-top:4px; }
    .admin-table { width:100%; border-collapse:collapse; font-size:14px; }
    .admin-table th { text-align:left; padding:10px 12px; color:var(--muted); font-weight:600;
      border-bottom:1px solid var(--line); font-size:12px; text-transform:uppercase; letter-spacing:.5px; }
    .admin-table td { padding:10px 12px; border-bottom:1px solid rgba(42,49,64,.4); }
    .admin-table tr:hover td { background:rgba(31,36,48,.5); }
    .admin-table .badge { display:inline-block; padding:2px 8px; border-radius:999px; font-size:11px; font-weight:600; }
    .badge-admin { background:rgba(122,162,247,.2); color:#7aa2f7; border:1px solid rgba(122,162,247,.3); }
    .badge-user { background:rgba(169,179,193,.1); color:#a9b3c1; border:1px solid rgba(169,179,193,.2); }
    .admin-toolbar { display:flex; gap:8px; margin-bottom:16px; align-items:center; }
    .admin-toolbar input { flex:1; background:var(--soft); border:1px solid var(--line);
      border-radius:8px; padding:8px 12px; color:var(--text); font-size:14px; }
    .admin-toolbar input:focus { outline:none; border-color:var(--accent); }
    .btn-sm { padding:6px 12px; font-size:13px; }
    .btn-danger { background:#3a1e1e; border-color:#8b3a3a; color:#ff9999; }
    .btn-danger:hover { background:#4a2a2a; }
    .admin-form { display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:16px; }
    .admin-form.cols-1 { grid-template-columns:1fr; }
    .admin-form label { font-size:13px; color:var(--muted); margin-bottom:4px; display:block; }
    .admin-form input, .admin-form select, .admin-form textarea {
      width:100%; background:var(--soft); border:1px solid var(--line);
      border-radius:8px; padding:8px 10px; color:var(--text); font-size:14px; }
    .admin-form .full { grid-column:1/-1; }
    .inline-edit { background:transparent; border:1px solid transparent; color:var(--text);
      padding:4px 6px; border-radius:4px; width:100%; }
    .inline-edit:focus { border-color:var(--accent); background:var(--soft); outline:none; }
    .person-row-name { font-weight:600; }
    .person-row-meta { font-size:12px; color:var(--muted); }

    /* ── Modals ── */
    .modal { position:fixed; inset:0; display:none; align-items:center;
      justify-content:center; background:rgba(0,0,0,.5); z-index:20; }
    .modal.open { display:flex; }
    .modal > .card { width:min(820px,calc(100% - 24px)); max-height:90vh; overflow-y:auto;
      background:#171a21; border:1px solid var(--line); border-radius:16px; padding:16px; }
    .pill { display:inline-block; padding:4px 8px; border-radius:999px; background:#1f2430;
      border:1px solid var(--line); margin:2px; font-size:12px; color:#a9b3c1;
      text-decoration:none; }
    .muted { color:#a9b3c1; }
    .portrait { width:120px; height:120px; object-fit:cover; border-radius:16px;
      border:2px solid var(--soft); background:#333; }
    .row { display:flex; gap:16px; align-items:flex-start; }
    .grow { flex:1; }
    .section { margin-top:12px; padding-top:10px; border-top:1px dashed var(--line); }
    .path { font-size:12px; color:#a9b3c1; line-height:1.4; }

    /* ── Media ── */
    .media-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(140px,1fr)); gap:8px; }
    .media-thumb { width:100%; height:100px; object-fit:cover; border-radius:10px;
      border:1px solid var(--line); cursor:zoom-in; }
    .media-embed { position:relative; width:100%; padding-top:56.25%; border:1px solid var(--line);
      border-radius:10px; overflow:hidden; background:#000; }
    .media-embed iframe { position:absolute; inset:0; width:100%; height:100%; border:0; }

    /* ── Compare panel ── */
    .compare { position:fixed; right:12px; top:64px; width:420px; max-height:70vh;
      overflow:auto; background:#171a21; border:1px solid var(--line); border-radius:14px;
      padding:12px; z-index:10; display:none; }

    /* ── File grid ── */
    .file-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(120px,1fr)); gap:8px; }
    .file-item { position:relative; display:block; aspect-ratio:1/1; border:1px solid var(--line);
      border-radius:10px; background:var(--soft); overflow:hidden; text-decoration:none;
      box-shadow:0 1px 0 rgba(0,0,0,.2); }
    .file-item::before { content:""; position:absolute; inset:0;
      background:radial-gradient(140% 100% at 110% -20%, var(--fc, rgba(122,162,247,.35)), transparent 55%);
      opacity:.45; pointer-events:none; }
    .file-item:hover { transform:translateY(-2px); box-shadow:0 8px 24px rgba(0,0,0,.25); }
    .file-thumb { position:absolute; inset:0; width:100%; height:100%; object-fit:cover; display:none; }
    .file-item.has-thumb .file-thumb { display:block; }
    .file-ico { position:absolute; inset:0; display:grid; place-items:center;
      font-size:34px; color:var(--text); opacity:.9; }
    .file-ext { position:absolute; left:8px; bottom:8px; font-weight:700; font-size:12px;
      letter-spacing:.3px; padding:2px 6px; border-radius:6px; background:rgba(0,0,0,.45); color:#fff; }
    .file-cap { position:absolute; right:8px; bottom:8px; max-width:70%; font-size:11px;
      color:#e8ecf1; opacity:.85; text-overflow:ellipsis; white-space:nowrap; overflow:hidden; }

    /* ── Lightbox viewer ── */
    .viewer { width:min(96vw,1200px); max-height:92vh; background:#0a0d12;
      border:1px solid var(--line); border-radius:14px; box-shadow:0 20px 60px rgba(0,0,0,.6);
      padding:10px; display:grid; grid-template-rows:1fr auto; gap:8px; position:relative; }
    .viewer img, .viewer video, .viewer iframe {
      max-width:100%; max-height:80vh; object-fit:contain; background:#000;
      border-radius:10px; display:none; }
    .viewer-caption { display:flex; gap:12px; align-items:center; color:var(--muted); font-size:13px; }
    .viewer-caption a { color:var(--accent); text-decoration:none; }
    .viewer-close { position:absolute; top:8px; right:10px; background:var(--soft);
      border:1px solid var(--line); color:var(--text); border-radius:10px;
      padding:6px 10px; cursor:pointer; }
    .viewer-nav { position:absolute; top:50%; transform:translateY(-50%); background:var(--soft);
      border:1px solid var(--line); color:var(--text); border-radius:999px;
      width:36px; height:36px; cursor:pointer; display:flex; align-items:center; justify-content:center; }
    .viewer-prev { left:8px; }
    .viewer-next { right:8px; }
    #viewerModal.modal { align-items:center; justify-content:center; }

    /* ── Frost background ── */
    .frost-bg {
      position:fixed; inset:0; z-index:-1;
      background:
        radial-gradient(1200px 800px at 10% 10%, rgba(122,162,247,.18), transparent 60%),
        radial-gradient(1000px 600px at 90% 20%, rgba(66,153,225,.12), transparent 65%),
        radial-gradient(900px 700px at 30% 85%, rgba(168,218,220,.10), transparent 60%),
        linear-gradient(120deg, #0b111a, #0d1b2a 40%, #0f1722 100%);
      filter:saturate(1.05);
      animation:drift 28s ease-in-out infinite alternate;
    }
    @keyframes drift {
      0%   { background-position:0px 0px, 0px 0px, 0px 0px, 0 0; }
      100% { background-position:40px -30px, -60px 25px, 30px -20px, 0 0; }
    }
    .frost-bg::after {
      content:""; position:absolute; inset:-10%;
      background:radial-gradient(800px 400px at 70% -10%, rgba(255,255,255,.06), transparent 60%);
      mix-blend-mode:screen; pointer-events:none;
      animation:drift 32s ease-in-out infinite alternate-reverse;
    }

    .loading { text-align:center; padding:24px; color:var(--muted); }
  </style>
</head>
<body>

<!-- Frost background -->
<div class="frost-bg"></div>

<!-- Login Page -->
<div id="login-page">
  <!-- Scrapboard with polaroid family photos -->
  <div class="scrapboard">
    <div class="twine"></div>
    <div class="polaroid polaroid-1">
      <div class="pin"></div>
      <img src="/3.png" alt="Family" loading="lazy" />
      <div class="caption">Memories</div>
    </div>
    <div class="polaroid polaroid-2">
      <div class="pin"></div>
      <img src="/4.png" alt="Family" loading="lazy" />
      <div class="caption">Together</div>
    </div>
    <div class="polaroid polaroid-3">
      <div class="pin"></div>
      <img src="/5.jpeg" alt="Family" loading="lazy" />
      <div class="caption">Heritage</div>
    </div>
    <div class="polaroid polaroid-4">
      <div class="pin"></div>
      <img src="/5.png" alt="Family" loading="lazy" />
      <div class="caption">Roots</div>
    </div>
  </div>

  <!-- Login form -->
  <div class="login-container">
    <div class="login-header">
      <!-- Bifrost rainbow bridge SVG -->
      <svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
        <!-- Rainbow bridge arc -->
        <path d="M8 52 Q32 4 56 52" stroke="url(#bifrost-grad)" stroke-width="3" fill="none" opacity=".9"/>
        <path d="M12 52 Q32 10 52 52" stroke="url(#bifrost-grad)" stroke-width="2.5" fill="none" opacity=".7"/>
        <path d="M16 52 Q32 16 48 52" stroke="url(#bifrost-grad)" stroke-width="2" fill="none" opacity=".5"/>
        <path d="M20 52 Q32 22 44 52" stroke="url(#bifrost-grad)" stroke-width="1.5" fill="none" opacity=".35"/>
        <!-- Glow -->
        <path d="M8 52 Q32 4 56 52" stroke="url(#bifrost-grad)" stroke-width="8" fill="none" opacity=".12" filter="blur(3px)"/>
        <!-- Stars -->
        <circle cx="18" cy="14" r="1.2" fill="#ffd43b" opacity=".8"/>
        <circle cx="46" cy="10" r="1" fill="#74c0fc" opacity=".7"/>
        <circle cx="32" cy="6" r="1.5" fill="#b197fc" opacity=".9"/>
        <circle cx="10" cy="24" r=".8" fill="#69db7c" opacity=".6"/>
        <circle cx="54" cy="20" r="1" fill="#ffa94d" opacity=".7"/>
        <!-- Ground line -->
        <line x1="4" y1="52" x2="60" y2="52" stroke="#4a5568" stroke-width="1" opacity=".4"/>
        <defs>
          <linearGradient id="bifrost-grad" x1="0" y1="0" x2="64" y2="0">
            <stop offset="0%" stop-color="#ff6b6b"/>
            <stop offset="20%" stop-color="#ffa94d"/>
            <stop offset="40%" stop-color="#ffd43b"/>
            <stop offset="60%" stop-color="#69db7c"/>
            <stop offset="80%" stop-color="#74c0fc"/>
            <stop offset="100%" stop-color="#b197fc"/>
          </linearGradient>
        </defs>
      </svg>
      <h1>Bifrost</h1>
      <span class="subtitle">Family Tree</span>
    </div>
    <div class="error" id="login-error" style="display:none;"></div>
    <form id="login-form">
      <div class="form-group">
        <label for="email">Email</label>
        <input type="email" id="email" placeholder="your@email.com" required />
      </div>
      <div class="form-group">
        <label for="password">Password</label>
        <input type="password" id="password" placeholder="password" required />
      </div>
      <button type="submit" class="login-btn">Cross the Bridge</button>
    </form>
  </div>
</div>

<!-- Editor Modal -->
<div id="editorModal" class="modal">
  <div class="card" style="max-width:900px">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h3 style="margin:0">Edit Person</h3>
      <div style="display:flex;gap:8px">
        <button class="btn" id="m-add-sibling">Add Sibling</button>
        <button class="btn" id="edClose">Close</button>
      </div>
    </div>
    <div class="section">
      <div class="form-row"><label>ID</label><input id="ed-id" readonly></div>
      <div class="form-row"><label>First Name</label><input id="ed-first"></div>
      <div class="form-row"><label>Last Name</label><input id="ed-last"></div>
      <div class="form-row"><label>Gender</label><input id="ed-gender" placeholder="M/F"></div>
      <div class="form-row"><label>Birthday</label><input id="ed-bday" placeholder="e.g. 1964 - 2008"></div>
      <div class="form-row"><label>Avatar URL</label><input id="ed-avatar"></div>
      <div class="form-row"><label>Bio</label><textarea id="ed-bio" rows="3"></textarea></div>
      <div class="form-row"><label>Tags</label><input id="ed-tags" placeholder="comma separated"></div>
      <div class="form-row"><label>Locations</label><input id="ed-locs" placeholder="comma separated"></div>
      <div class="form-row"><label>Father (id)</label><input id="ed-father" placeholder="id"></div>
      <div class="form-row"><label>Mother (id)</label><input id="ed-mother" placeholder="id"></div>
      <div class="form-row"><label>Spouse(s) (ids)</label><input id="ed-spouses" placeholder="comma separated ids"></div>
      <div class="form-row"><label>Children (ids)</label><input id="ed-children" placeholder="comma separated ids"></div>
      <div class="form-row"><label>Photo URLs</label><textarea id="ed-photos" rows="2" placeholder="one URL per line"></textarea></div>
      <div class="form-row"><label>Video URLs</label><textarea id="ed-videos" rows="2" placeholder="one URL per line (YouTube, mp4...)"></textarea></div>
      <div class="form-row"><label>Files (URL name)</label><textarea id="ed-files" rows="2" placeholder="one per line: URL [space] Name(optional)"></textarea></div>
      <div style="display:flex;gap:8px;justify-content:flex-end">
        <button class="btn accent" id="edSave">Save</button>
      </div>
    </div>
  </div>
</div>

<!-- Admin Panel Modal -->
<div id="adminPanel" class="modal">
  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
      <h2 style="margin:0">Admin Panel</h2>
      <button class="btn" id="adminPanelClose">Close</button>
    </div>
    <div class="admin-tabs">
      <button class="admin-tab active" data-tab="dashboard">Dashboard</button>
      <button class="admin-tab" data-tab="people">People</button>
      <button class="admin-tab" data-tab="users">Users</button>
      <button class="admin-tab" data-tab="data">Import / Export</button>
    </div>

    <!-- Dashboard Tab -->
    <div class="admin-content active" id="tab-dashboard">
      <div class="admin-stats" id="admin-stats"></div>
    </div>

    <!-- People Tab -->
    <div class="admin-content" id="tab-people">
      <div class="admin-toolbar">
        <input type="text" id="admin-people-search" placeholder="Filter people..." />
        <button class="btn accent btn-sm" id="admin-add-person">+ Add Person</button>
      </div>
      <div style="max-height:55vh;overflow-y:auto">
        <table class="admin-table">
          <thead><tr><th>ID</th><th>Name</th><th>Gender</th><th>Birth</th><th>Death</th><th>Actions</th></tr></thead>
          <tbody id="admin-people-tbody"></tbody>
        </table>
      </div>
    </div>

    <!-- Users Tab -->
    <div class="admin-content" id="tab-users">
      <div class="admin-toolbar">
        <span style="font-size:14px;color:var(--muted)">Manage system users</span>
        <button class="btn accent btn-sm" id="admin-add-user">+ Add User</button>
      </div>
      <div id="admin-user-form" style="display:none;margin-bottom:16px;background:var(--soft);border:1px solid var(--line);border-radius:12px;padding:16px;">
        <h4 style="margin:0 0 12px" id="admin-user-form-title">New User</h4>
        <div class="admin-form">
          <div>
            <label>Name</label>
            <input type="text" id="au-name" placeholder="Display name" />
          </div>
          <div>
            <label>Email</label>
            <input type="email" id="au-email" placeholder="user@example.com" />
          </div>
          <div>
            <label>Password</label>
            <input type="password" id="au-password" placeholder="Min 8 characters" />
          </div>
          <div>
            <label>Role</label>
            <select id="au-role">
              <option value="false">User</option>
              <option value="true">Admin</option>
            </select>
          </div>
        </div>
        <div style="display:flex;gap:8px;justify-content:flex-end">
          <button class="btn btn-sm" id="au-cancel">Cancel</button>
          <button class="btn accent btn-sm" id="au-save">Save User</button>
        </div>
      </div>
      <table class="admin-table">
        <thead><tr><th>ID</th><th>Name</th><th>Email</th><th>Role</th><th>Created</th><th>Actions</th></tr></thead>
        <tbody id="admin-users-tbody"></tbody>
      </table>
    </div>

    <!-- Import/Export Tab -->
    <div class="admin-content" id="tab-data">
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
        <div style="background:var(--soft);border:1px solid var(--line);border-radius:12px;padding:20px;">
          <h3 style="margin:0 0 8px">Export</h3>
          <p class="muted" style="font-size:13px;margin:0 0 16px">Download the full family tree data as JSON.</p>
          <button class="btn accent" id="admin-export">Export JSON</button>
        </div>
        <div style="background:var(--soft);border:1px solid var(--line);border-radius:12px;padding:20px;">
          <h3 style="margin:0 0 8px">Import</h3>
          <p class="muted" style="font-size:13px;margin:0 0 16px">Import a JSON file to replace all data.</p>
          <label class="btn accent" for="admin-fileImport" style="display:inline-block;cursor:pointer">Choose File…</label>
          <input type="file" id="admin-fileImport" accept="application/json" style="display:none">
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Main App -->
<div id="main-app">
  <div class="topbar">
    <strong>Bifrost</strong>
    <div class="search">
      <div class="searchbox">
        <input id="q" placeholder="Search: name, bio, tags, locations..." />
        <button class="btn" id="clearBtn">Clear</button>
      </div>
      <div id="sugg" class="sugg"></div>
    </div>
    <button class="btn accent" id="adminBtn" style="display:none">Admin</button>
    <button class="btn" id="center-btn">Center</button>
    <button class="btn logout" id="logout-btn">Logout</button>
  </div>
  <div id="FamilyChart" class="f3"></div>
</div>

<!-- Profile Modal -->
<div id="profileModal" class="modal">
  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h2 id="m-name" style="margin:0"></h2>
      <div style="display:flex;gap:8px">
        <button class="btn" id="m-edit">Edit</button>
        <button class="btn danger" id="m-delete">Delete…</button>
        <button class="btn" id="m-close">Close</button>
      </div>
    </div>
    <div class="row" style="margin-top:12px">
      <img id="m-portrait" class="portrait" alt="portrait"/>
      <div class="grow">
        <div class="muted" id="m-bday"></div>
        <div id="m-struct" class="path" style="margin-top:6px;"></div>
      </div>
    </div>
    <div class="section">
      <h3 style="margin:0 0 6px 0;">About</h3>
      <p id="m-bio" style="margin-top:0"></p>
      <div id="m-tags"></div>
    </div>
    <div class="section">
      <h3 style="margin:0 0 6px 0;">Photos</h3>
      <div id="m-photos" class="media-grid"></div>
    </div>
    <div class="section">
      <h3 style="margin:0 0 6px 0;">Videos</h3>
      <div id="m-videos" class="media-grid"></div>
    </div>
    <div class="section">
      <h3 style="margin:0 0 6px 0;">Files</h3>
      <div id="m-files"></div>
    </div>
    <div class="section">
      <h3 style="margin:0 0 6px 0;">Social Media</h3>
      <div id="m-social"></div>
    </div>
  </div>
</div>

<!-- Compare Panel -->
<div id="comparePanel" class="compare">
  <div style="display:flex;justify-content:space-between;align-items:center">
    <strong>Comparison</strong>
    <span id="c-close" class="muted" style="cursor:pointer">close</span>
  </div>
  <div class="row" style="margin-top:8px">
    <img id="c-ava-a" class="portrait" alt="A"/>
    <img id="c-ava-b" class="portrait" alt="B"/>
  </div>
  <div id="c-who" style="margin-top:8px"></div>
  <div class="section">
    <div><strong>Relation</strong></div>
    <div id="c-rel" class="path"></div>
  </div>
  <div class="section">
    <div><strong>Shared Tags</strong></div>
    <div id="c-tags"></div>
  </div>
  <div class="section">
    <div><strong>Shared Locations</strong></div>
    <div id="c-locs"></div>
  </div>
</div>

<!-- Media Viewer (lightbox) -->
<div id="viewerModal" class="modal">
  <div class="viewer">
    <button id="viewerPrev" class="viewer-nav viewer-prev" aria-label="Previous">‹</button>
    <button id="viewerNext" class="viewer-nav viewer-next" aria-label="Next">›</button>
    <button id="viewerClose" class="viewer-close" aria-label="Close">✕</button>
    <img id="viewerImg" alt="" referrerpolicy="no-referrer" />
    <video id="viewerVideo" controls playsinline></video>
    <iframe id="viewerFrame" loading="lazy"></iframe>
    <div class="viewer-caption">
      <a id="viewerOpen" href="#" target="_blank" rel="noopener">Open original</a>
      <span id="viewerText"></span>
    </div>
  </div>
</div>

<script type="module" src="/src/main.js"></script>
</body>
</html>
